//AES decryption
//file:crypto_atx.js
// tested with ver. 1.94
//usage:
//  var AESCrypt = require('./crypto_atx.js');
//  var   hw  = AESCrypt.decrypt(msg_xml);


var crypto = require('crypto');
var AESCrypt = {};

var enc_algorithm = 'aes-256-cbc';
var cryptkey = 'Thispasswordisveryuncommonforher';
var iv = '1234567890123456';

exports.decrypt = function(encryptdata) {
  //Get iv from message ( first 16 bytes )
  var ivd = encryptdata.slice(0,16);
  //Decrypt rest of message and return clear text
  return  AESCrypt._decrypt(cryptkey, ivd, encryptdata.slice(16)); 
}

exports.encrypt = function( cleardata) {
  return AESCrypt._encrypt (cryptkey, iv, cleardata);
}

AESCrypt._decrypt = function(cryptkey, iv, encryptdata) {
  var decipher = crypto.createDecipheriv(enc_algorithm , cryptkey, iv);
  var cleardata=decipher.update(encryptdata, 'binary', 'utf8');
  return cleardata;
}


AESCrypt._encrypt = function(cryptkey, iv, cleardata) {
  var encipher = crypto.createCipheriv( enc_algorithm, cryptkey, iv),
  encryptdata = encipher.update(cleardata, 'utf8', 'binary');
return encryptdata;
}
//End



